## Что это?
Набор скриптов для того, чтобы быстро поднять простенький кластер Kubernetes с сетью на Flannel.

Окружение:
* виртуальная машина (VirtualBox, но сойдет любой способ)
* Ubuntu 18.04

У каждой виртуальной машины есть два сетевых адаптера
* NAT (для доступа в Internet)
* Host-only (для общения с другими машинами и нашей настоящей)

## Создание кластера

1. Устанавливаем необходимые пакеты и закрепляем их версии

`sudo ./install`

1. Редактируем init, чтобы указать там, какой IP у нашего Host-only адаптера.

1. Создаем кластер

`sudo ./init`

Результатом работы init будет строка с командой `kubeadm join ...`, которую нужно сохранить, если мы будем использовать более 1 ноды

1. Копируем файл конфигурации для kubectl

```
$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

1. Разрешаем запускать рабочую нагрузку на нашей единственной ноде

`kubectl taint nodes --all node-role.kubernetes.io/master-`

1. Настраиваем сеть. **Внимание! В файле kube-flannel.yml указан интерфейс enp0s8.** Если в виртуальной машине он называется по-другому (допустим, enp1s2), то нужно выполнить команду

`sed -i s/enp0s8/enp1s2/g kube-flannel.yml`

1. Устанавливаем Flannel

`kubectl apply -f kube-flannel.yml`

## Присоединение ноды

1. Устанавливаем необходимые пакеты и закрепляем их версии

`sudo ./install`

1. Редактируем файл join, чтобы:
- указать там, какой IP у нашего Host-only адаптера.
- вставить туда строку `kubeadm join ...` из создания кластера

1. Выполняем присоединение

`sudo ./join`

